<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Q-Lite Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>

<body class="h-screen w-screen bg-gray-100 font-sans flex flex-col">
    <!-- Header -->
    <div class="h-[10vh] flex items-center justify-center text-3xl font-bold text-gray-800">
        <a href="https://www.npmjs.com/package/@purnapattela/q-lite" target="_blank" class="hover:underline">
            @purnapattela/q-lite
        </a>
    </div>

    <!-- Description -->
    <div class="text-center px-6 text-gray-700 text-lg mb-6">
        <p>
            This demo compares sending bulk emails <b>with</b> and <b>without</b> using <code>Q-Lite</code>.
            Without a queue, tasks run immediately and can block execution. <br>
            With <code>Q-Lite</code>, tasks are scheduled, retried, delayed, and processed efficiently in the
            background.
        </p>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex items-center justify-center">
        <div class="grid grid-cols-2 gap-6 w-11/12 max-w-6xl">

            <!-- Without Q-Lite -->
            <div class="flex flex-col items-center bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i data-feather="x-circle" class="text-red-500"></i> Without Q-Lite
                </h2>
                <button onclick="runWithout()"
                    class="flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl shadow-md transition">
                    <i data-feather="play"></i> Run Task
                </button>
                <pre id="outputWithout"
                    class="bg-gray-900 text-green-400 text-sm rounded-xl mt-4 p-4 w-full h-48 overflow-auto">Waiting...</pre>
            </div>

            <!-- With Q-Lite -->
            <div class="flex flex-col items-center bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i data-feather="check-circle" class="text-green-500"></i> With Q-Lite
                </h2>
                <button onclick="runWith()"
                    class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl shadow-md transition">
                    <i data-feather="play-circle"></i> Queue Task
                </button>
                <pre id="outputWith"
                    class="bg-gray-900 text-green-400 text-sm rounded-xl mt-4 p-4 w-full h-48 overflow-auto">Waiting...</pre>
                <a href="http://localhost:3000" target="_blank"
                    class="mt-4 text-sm text-blue-600 hover:underline flex items-center gap-1">
                    <i data-feather="external-link"></i> Open Q-Lite Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Pros & Cons -->
    <div class="bg-white shadow-inner p-6 mt-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Pros & Cons of Using Q-Lite</h3>
        <div class="grid grid-cols-2 gap-6 max-w-4xl mx-auto">
            <!-- Pros -->
            <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                <h4 class="font-semibold text-green-700 mb-2 flex items-center gap-2">
                    <i data-feather="thumbs-up"></i> Pros
                </h4>
                <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                    <li>Prevents server overload by handling tasks in the background</li>
                    <li>Supports retries, delays, and prioritization</li>
                    <li>Efficient for bulk operations like sending emails</li>
                    <li>Provides a clear dashboard to monitor tasks</li>
                </ul>
            </div>

            <!-- Cons -->
            <div class="bg-red-50 border border-red-200 rounded-xl p-4">
                <h4 class="font-semibold text-red-700 mb-2 flex items-center gap-2">
                    <i data-feather="thumbs-down"></i> Cons
                </h4>
                <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
                    <li>Requires extra setup and running a queue server</li>
                    <li>Not always needed for small-scale apps</li>
                    <li>May add slight latency compared to immediate execution</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "f14f102e9329fd5466f5d408c6b6d994";

        async function runWithout() {
            document.getElementById("outputWithout").textContent = "Running...";
            const res = await fetch("/without-queue");
            const data = await res.json();
            document.getElementById("outputWithout").textContent = JSON.stringify(data, null, 2);
        }

        async function runWith() {
            document.getElementById("outputWith").textContent = "Queuing...";
            const start = Date.now();
            try {
                const res = await fetch("http://localhost:3000/add/emailQueue?delay=5000&priority=10&attempts=5&backoff=2000", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-api-key": API_KEY
                    },
                    body: JSON.stringify({ to: "user@example.com", task: "send email" })
                });
                const data = await res.json();
                const end = Date.now();
                document.getElementById("outputWith").textContent =
                    `Job queued with ID: ${data.id}\nRequest Time: ${(end - start)} ms`;
            } catch (err) {
                document.getElementById("outputWith").textContent = "Error: " + err.message;
            }
        }

        feather.replace();
    </script>
</body>

</html>